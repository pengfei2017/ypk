<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1" />
    <title>虚拟订单退款</title>
    <link rel="stylesheet" type="text/css" href="../../css/base.css">
    <link rel="stylesheet" type="text/css" href="../../css/nctouch_member.css">
    <link rel="stylesheet" type="text/css" href="../../css/nctouch_common.css">
    <link rel="stylesheet" type="text/css" href="../../css/nctouch_cart.css">
    <style type="text/css">
        article{
            font-size: 0.7rem;
            text-indent: 2rem;
            color: #C09853;
            background-color: #FCF8E3;
            padding: 9px 14px;
            margin: 10px auto;
            border: 1px solid #FBEED5;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
        }
        .submit{
            color: #FFF;
            background-color: #48CFAE;
            border-radius: 3px;
            color: #FFF;
            background-color: #48CFAE;
            border-radius: 3px;
            width: 5rem;
            text-align: center;
            height: 2rem;
            font-size: 0.7rem;
        }
    </style>
</head>
<body>
<header id="header" class="fixed">
    <div class="header-wrap">
        <div class="header-l"> <a href="javascript:history.back();"> <i class="back"></i> </a> </div>
        <div class="header-title">
            <h1>虚拟订单退款</h1>
        </div>
    </div>
    <div class="header-r"> <a id="header-nav" href="javascript:void(0);"><i class="more"></i><sup></sup></a> </div>
    <div class="nctouch-nav-layout">
        <div class="nctouch-nav-menu"> <span class="arrow"></span>
            <ul>
                <li><a href="../../index.html"><i class="home"></i>首页</a></li>
                <li><a href="../search.html"><i class="search"></i>搜索</a></li>
                <li><a href="../product_first_categroy.html"><i class="categroy"></i>分类</a></li>
                <li><a href="javascript:void(0);"><i class="message"></i>消息<sup></sup></a></li>
                <li><a href="../cart_list.html"><i class="cart"></i>购物车<sup></sup></a></li>
                <li><a href="../member/member.html"><i class="member"></i>我的</a></li>
            </ul>
        </div>
    </div>
</header>
<div class="nctouch-main-layout">
    <div class="nctouch-order-search">
        <article>
            操作提示：
            1. 有效期内的未使用兑换码都可以在系统规定的有效期内申请退款，系统同意退款后，会将退款金额以<em>“预存款”</em>的形式返还到您的余额账户中（充值卡部分只能退回到充值卡余额）。<br/>
            2. 申请退款时，必须在服务开始时间之前的系统规定的时间外发起退款，如果小于系统规定的时间，则不能发起退款。<br/>
            3. 如果平台不同意退款，自动解除兑换码的锁定状态，在有效期内可以继续兑换使用。
        </article>
        <form id="formsubmit" method="post" action="/mobile/member_index/add_vr_refund" enctype="multipart/form-data" style="font-size:0.7rem;padding: 7px 9px;">
            <input type="hidden" name="key" value=""/>
            <input type="hidden" name="order_id" value=""/>
            <dl>
               <dd>可退款的兑换码：</dd>
                <dt style="padding-left: 1rem;" id="exchangeCodeList">
                    <!--<label style="display: block;margin-top: 0.5rem;">-->
                        <!--<input type="checkbox" value="21" name="rec_id[]" checked="checked"/>714001801946078258-->
                    <!--</label>-->
                    <!--<label style="display: block;margin-top: 0.5rem;">-->
                        <!--<input type="checkbox" value="22" name="rec_id[]" checked="checked"/>714001801946078258-->
                    <!--</label>-->
                    <!--<label style="display: block;margin-top: 0.5rem;">-->
                        <!--<input type="checkbox" value="23" name="rec_id[]" checked="checked"/>714001801946078258-->
                    <!--</label>-->
                </dt>
            </dl>
            <dl style="margin-top: 0.5rem;">
                <dd>退款说明：</dd>
                <dt style="padding-top: 0.5rem;">
                    <textarea name="buyer_message" rows="3" style="width: 15rem;height: 5rem;"></textarea>
                </dt>
            </dl>
            <dl>
                <dd></dd>
                <dt style="text-align: center;">
                    <input type="submit" class="submit" value="确认提交">
                </dt>
            </dl>
        </form>
    </div>
</div>

<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/zepto.js"></script>
<script type="text/javascript" src="../../js/simple-plugin.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../js/js_template/footer.js"></script>
<script type="text/javascript" src="../../js/jquery-1.10.2.js"></script>

<script type="text/javascript">
    if(getQueryString("resdata")=="noorder"){
        Zepto.sDialog({
            skin: "red",
            content: '要退款的订单不存在',
            okBtn: false,
            cancelBtn: false
        });
        setTimeout(function () {
            window.location="vr_order_list.html";
        },2500);
    }
    if(getQueryString("resdata")=="no_begin_time"){
        Zepto.sDialog({
            skin: "red",
            content: '订单不存在开始时间，无法退款',
            okBtn: false,
            cancelBtn: false
        });
        setTimeout(function () {
            window.location="vr_order_list.html";
        },2500);
    }
    if(getQueryString("resdata")=="forbidden"){
        Zepto.sDialog({
            skin: "red",
            content: '您发起退款的时间距离服务开始时间小于退款时限，禁止退款',
            okBtn: false,
            cancelBtn: false
        });
        setTimeout(function () {
            window.location="vr_order_list.html";
        },2500);
    }
    if(getQueryString("resdata")=="ok"){
        Zepto.sDialog({
            skin: "red",
            content: '退款申请已提交，请等待平台审核结果',
            okBtn: false,
            cancelBtn: false
        });
        setTimeout(function () {
            window.location="vr_order_list.html";
        },2500);
    }
    if(getQueryString("resdata")=="err"){
        Zepto.sDialog({
            skin: "red",
            content: '退款失败，请稍后再试',
            okBtn: false,
            cancelBtn: false
        });
    }

    $(function () {
        var key = getCookie('key');
        $("input[name='key']").val(key);
        $("input[name='order_id']").val(getQueryString("order_id"));

        //加载可以兑换的兑换码列表
        $.post(ApiUrl+"/member_vr_order/get_exchange_code_list",{"key":key,"order_id":getQueryString("order_id")},function (res) {
            if(res!=""){
                var str="";
                res=eval("("+res+")");
                for(var k in res.datas){
                    str+='<label style="display: block;margin-top: 0.5rem;">';
                    str+='<input type="checkbox" value="'+res.datas[k].rec_id+'" name="rec_id[]" checked="checked"/>'+res.datas[k].vr_code;
                    str+='</label>';
                }
                $("#exchangeCodeList").html(str);
            }
        },null);
//        $(".submit").click(function () {
//            var formData = new FormData(document.getElementById("formsubmit"));
//            $.ajax({
//                type: "POST",
//                url: ApiUrl+"/member_index/add_vr_refund",
//                data:formData,
//                async:false,
//                success: function(rs){
//                    checkLogin(rs.login);
//                    if(rs == 'ok') {
//                        $.sDialog({
//                            skin:"block",
//                            content:'提交成功',
//                            okBtn:false,
//                            cancelBtn:false
//                        });
//                    } else {
//                        $.sDialog({
//                            skin:"block",
//                            content:'提交失败',
//                            okBtn:false,
//                            cancelBtn:false
//                        });
//                    }
//                }
//            });
//            return false;
//        });
    });
</script>
</body>
</html>